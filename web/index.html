<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="description" content="A new Flutter project.">

  <!-- iOS meta tags & icons -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="muses">
  <link rel="apple-touch-icon" href="/icons/Icon-192.png">

  <title>muses</title>
  <link rel="manifest" href="/manifest.json">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@observablehq/inspector@3/dist/inspector.css" />
</head>
<body>
  <!-- This script installs service_worker.js to provide PWA functionality to
       application. For more information, see:
       https://developers.google.com/web/fundamentals/primers/service-workers -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function () {
        navigator.serviceWorker.register('/flutter_service_worker.js');
      });
    }
  </script>
  <script type='module'>
    import { Runtime, Inspector } from 'https://cdn.jsdelivr.net/npm/@observablehq/runtime@4/dist/runtime.js';

    window.renderObservable = async function(path) {
      const mod = await import(`https://notebook-five.now.sh/${path}.js`);
      const notebook = mod.default;

      let target = undefined;

      const platformViews = document.querySelectorAll('flt-platform-view')

      for (let i = 0; i < platformViews.length; i++) {
        const pView = platformViews[i];
        const shadow = pView.shadowRoot;

        if (shadow == undefined) {
          continue
        }

        for(let i = 0; i < shadow.childNodes.length; i++) {
          console.log(i + '  ' + shadow.childNodes[i].id)
          if (shadow.childNodes[i].id == 'observable-view') {
            target = shadow.childNodes[i];
            break;
          }
        }

        if (target != undefined) {
          break;
        }
      }

      if (target) {
        new Runtime().module(notebook, Inspector.into(target));
      }
    }
  </script>
  <script src="main.dart.js" type="application/javascript"></script>
</body>
</html>
